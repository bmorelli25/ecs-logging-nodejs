[[morgan]]
== ECS Logging with Morgan

This Node.js package provides a formatter for the https://github.com/expressjs/morgan#readme[morgan]
logging middleware -- commonly used with Express -- compatible with
{ecs-logging-ref}/intro.html[ELastic Common Schema (ECS) logging].
In combination with the https://www.elastic.co/beats/filebeat[Filebeat] shipper,
you can https://www.elastic.co/log-monitoring[monitor all your logs] in one 
place in the Elastic Stack.


[float]
=== Setup

XXX Q: Do these setup-step-1 anchors need to be unique for *all* docs here?

[float]
[[setup-step-1]]
=== Step 1: Install

[source,cmd]
----
$ npm install @elastic/ecs-morgan-format
----

[float]
[[setup-step-1]]
=== Step 1: Configure

[source,js]
----
const app = require('express')()
const morgan = require('morgan')
const ecsFormat = require('@elastic/ecs-morgan-format')

app.use(morgan(ecsFormat())) <1>

app.get('/', function (req, res) {
  res.send('hello, world!')
})

app.listen(3000)
----
<1> Pass the ECS formatter to `morgan()`.

See usage discussion and examples below.

[float]
[[setup-step-3]]
==== Step 3: Configure Filebeat

The best way to collect the logs once they are ECS-formatted is with https://www.elastic.co/beats/filebeat[Filebeat]:

include::{ecs-repo-dir}/setup.asciidoc[tag=configure-filebeat]


[float]
[[usage]]
=== Usage

XXX
